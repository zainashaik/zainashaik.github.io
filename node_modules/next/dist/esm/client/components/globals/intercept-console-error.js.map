{"version":3,"sources":["../../../../src/client/components/globals/intercept-console-error.ts"],"sourcesContent":["import isError from '../../../lib/is-error'\nimport { isNextRouterError } from '../is-next-router-error'\nimport { captureStackTrace } from '../react-dev-overlay/internal/helpers/capture-stack-trace'\nimport { handleClientError } from '../react-dev-overlay/internal/helpers/use-error-handler'\n\nexport const originConsoleError = window.console.error\n\n// Patch console.error to collect information about hydration errors\nexport function patchConsoleError() {\n  // Ensure it's only patched once\n  if (typeof window === 'undefined') {\n    return\n  }\n  window.console.error = function error(...args: any[]) {\n    let maybeError: unknown\n    let isReplayedError = false\n\n    if (process.env.NODE_ENV !== 'production') {\n      const replayedError = matchReplayedError(...args)\n      if (replayedError) {\n        isReplayedError = true\n        maybeError = replayedError\n      } else {\n        // See https://github.com/facebook/react/blob/d50323eb845c5fde0d720cae888bf35dedd05506/packages/react-reconciler/src/ReactFiberErrorLogger.js#L78\n        maybeError = args[1]\n      }\n    } else {\n      maybeError = args[0]\n    }\n\n    if (!isNextRouterError(maybeError)) {\n      if (process.env.NODE_ENV !== 'production') {\n        // Create an origin stack that pointing to the origin location of the error\n        if (!isReplayedError && isError(maybeError)) {\n          captureStackTrace(maybeError)\n        }\n\n        handleClientError(\n          // replayed errors have their own complex format string that should be used,\n          // but if we pass the error directly, `handleClientError` will ignore it\n          maybeError,\n          args\n        )\n      }\n\n      originConsoleError.apply(window.console, args)\n    }\n  }\n}\n\nfunction matchReplayedError(...args: unknown[]): Error | null {\n  // See\n  // https://github.com/facebook/react/blob/65a56d0e99261481c721334a3ec4561d173594cd/packages/react-devtools-shared/src/backend/flight/renderer.js#L88-L93\n  //\n  // Logs replayed from the server look like this:\n  // [\n  //   \"%c%s%c %o\\n\\n%s\\n\\n%s\\n\",\n  //   \"background: #e6e6e6; ...\",\n  //   \" Server \", // can also be e.g. \" Prerender \"\n  //   \"\",\n  //   Error\n  //   \"The above error occurred in the <Page> component.\"\n  //   ...\n  // ]\n  if (\n    args.length > 3 &&\n    typeof args[0] === 'string' &&\n    args[0].startsWith('%c%s%c ') &&\n    typeof args[1] === 'string' &&\n    typeof args[2] === 'string' &&\n    typeof args[3] === 'string'\n  ) {\n    const maybeError = args[4]\n    if (isError(maybeError)) {\n      return maybeError\n    }\n  }\n\n  return null\n}\n"],"names":["isError","isNextRouterError","captureStackTrace","handleClientError","originConsoleError","window","console","error","patchConsoleError","args","maybeError","isReplayedError","process","env","NODE_ENV","replayedError","matchReplayedError","apply","length","startsWith"],"mappings":"AAAA,OAAOA,aAAa,wBAAuB;AAC3C,SAASC,iBAAiB,QAAQ,0BAAyB;AAC3D,SAASC,iBAAiB,QAAQ,4DAA2D;AAC7F,SAASC,iBAAiB,QAAQ,0DAAyD;AAE3F,OAAO,MAAMC,qBAAqBC,OAAOC,OAAO,CAACC,KAAK,CAAA;AAEtD,oEAAoE;AACpE,OAAO,SAASC;IACd,gCAAgC;IAChC,IAAI,OAAOH,WAAW,aAAa;QACjC;IACF;IACAA,OAAOC,OAAO,CAACC,KAAK,GAAG,SAASA;QAAM,IAAA,IAAA,OAAA,UAAA,QAAA,AAAGE,OAAH,UAAA,OAAA,OAAA,GAAA,OAAA,MAAA;YAAGA,KAAH,QAAA,SAAA,CAAA,KAAc;;QAClD,IAAIC;QACJ,IAAIC,kBAAkB;QAEtB,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;YACzC,MAAMC,gBAAgBC,sBAAsBP;YAC5C,IAAIM,eAAe;gBACjBJ,kBAAkB;gBAClBD,aAAaK;YACf,OAAO;gBACL,iJAAiJ;gBACjJL,aAAaD,IAAI,CAAC,EAAE;YACtB;QACF,OAAO;YACLC,aAAaD,IAAI,CAAC,EAAE;QACtB;QAEA,IAAI,CAACR,kBAAkBS,aAAa;YAClC,IAAIE,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;gBACzC,2EAA2E;gBAC3E,IAAI,CAACH,mBAAmBX,QAAQU,aAAa;oBAC3CR,kBAAkBQ;gBACpB;gBAEAP,kBACE,4EAA4E;gBAC5E,wEAAwE;gBACxEO,YACAD;YAEJ;YAEAL,mBAAmBa,KAAK,CAACZ,OAAOC,OAAO,EAAEG;QAC3C;IACF;AACF;AAEA,SAASO;IAAmB,IAAA,IAAA,OAAA,UAAA,QAAA,AAAGP,OAAH,UAAA,OAAA,OAAA,GAAA,OAAA,MAAA;QAAGA,KAAH,QAAA,SAAA,CAAA,KAAkB;;IAC5C,MAAM;IACN,wJAAwJ;IACxJ,EAAE;IACF,gDAAgD;IAChD,IAAI;IACJ,+BAA+B;IAC/B,gCAAgC;IAChC,kDAAkD;IAClD,QAAQ;IACR,UAAU;IACV,wDAAwD;IACxD,QAAQ;IACR,IAAI;IACJ,IACEA,KAAKS,MAAM,GAAG,KACd,OAAOT,IAAI,CAAC,EAAE,KAAK,YACnBA,IAAI,CAAC,EAAE,CAACU,UAAU,CAAC,cACnB,OAAOV,IAAI,CAAC,EAAE,KAAK,YACnB,OAAOA,IAAI,CAAC,EAAE,KAAK,YACnB,OAAOA,IAAI,CAAC,EAAE,KAAK,UACnB;QACA,MAAMC,aAAaD,IAAI,CAAC,EAAE;QAC1B,IAAIT,QAAQU,aAAa;YACvB,OAAOA;QACT;IACF;IAEA,OAAO;AACT"}